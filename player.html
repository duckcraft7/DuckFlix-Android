<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-inline' https://archive.org; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content: https:; connect-src *;">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover, user-scalable=no">
    <title>Carregando Player...</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; overflow: hidden; }
        video { width: 100%; height: 100%; }
    </style>
</head>
<body>

    <video id="movie-player" controls autoplay>
        </video>

    <script>
        // (O script do player para carregar/salvar progresso e usar Enter é o mesmo da versão anterior)
         document.addEventListener('DOMContentLoaded', () => {
            const player = document.getElementById('movie-player');
            let videoId = null;
            let saveInterval = null;

            function initializePlayer() {
                const params = new URLSearchParams(window.location.search);
                const videoSrc = decodeURIComponent(params.get('src'));
                const videoTitle = decodeURIComponent(params.get('title'));
                videoId = params.get('id');
                const startTime = parseFloat(params.get('time') || '0');

                if (videoTitle) document.title = `Assistindo: ${videoTitle}`;
                if (!videoId) { console.error("ID do vídeo não encontrado!"); return; }
                if (!videoSrc || videoSrc === 'null' || videoSrc === 'undefined') { console.error("Fonte de vídeo inválida!"); return; }

                player.src = videoSrc;

                const storageKey = `progress_${videoId}`;

                player.addEventListener('loadedmetadata', () => {
                    if (startTime > 1 && startTime < player.duration) {
                        player.currentTime = startTime;
                    }
                    player.play().catch(e => console.error("Erro autoplay:", e));
                }, { once: true });

                if (saveInterval) clearInterval(saveInterval);
                saveInterval = setInterval(() => {
                    if (!player.paused && player.currentTime > 0 && player.duration > 0) {
                        if ((player.currentTime / player.duration) < 0.95) {
                            localStorage.setItem(storageKey, player.currentTime.toString());
                        } else {
                            localStorage.removeItem(storageKey);
                            if(saveInterval) clearInterval(saveInterval);
                        }
                    }
                }, 15000);

                player.addEventListener('ended', () => {
                    localStorage.removeItem(storageKey);
                    if(saveInterval) clearInterval(saveInterval);
                });

                 document.addEventListener('keydown', handleEnterKey);

                window.addEventListener('unload', () => {
                    if (saveInterval) clearInterval(saveInterval);
                    document.removeEventListener('keydown', handleEnterKey);
                    if (videoId && !player.paused && player.currentTime > 0 && player.duration > 0 && (player.currentTime / player.duration) < 0.95) {
                       localStorage.setItem(`progress_${videoId}`, player.currentTime.toString());
                    }
                });
            }

            function handleEnterKey(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    if (player.paused) player.play().catch(e => console.error("Erro play:", e));
                    else player.pause();
                }
            }

             // Inicia quando o Cordova está pronto ou imediatamente (fallback)
             document.addEventListener('deviceready', initializePlayer, false);
             if (typeof cordova === 'undefined') {
                initializePlayer();
             }

        }); // Fim DOMContentLoaded
    </script>
    <script src="cordova.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
